<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StayMyPg - Find Your Perfect Stay</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<nav class="navbar">
    <a href="/" class="logo">
        <img src="/image/logo.jpeg" alt="Logo" style="width: 150px; height: 130px; object-fit: contain;">
    </a>
    <div class="nav-links">
        <a href="/" class="nav-btn active">Home</a>
        <a href="/contact" class="nav-btn">Contact</a>
        <% if (user) { %>
            <a href="/logout" class="nav-btn logout">Logout</a>
        <% } else { %>
            <a href="/login" class="nav-btn">Login</a>
        <% } %>
    </div>
</nav>

<header class="hero">
    <div class="hero-content">
        <h1>Find Your Perfect <span class="blue-text">PG & Hostel</span></h1>
        
        <form action="/search" method="GET" class="search-box">
            <div class="input-group">
                <label>Choose Location</label>
                <select name="location" id="locationSelect" required onchange="updateColleges()">
                    <option value="">Select area in Pune</option>
                    <% if (typeof areaData !== 'undefined') { %>
                        <% areaData.forEach(area => { %>
                            <option value="<%= area.location %>"><%= area.location %></option>
                        <% }) %>
                    <% } %>
                </select>
            </div>
            
            <div class="input-group">
                <label>Your College</label>
                <select name="college" id="collegeSelect">
                    <option value="">Select location first</option>
                </select>
            </div>
            
            <button type="submit" class="search-btn">Find PGs</button>
        </form>
    </div>
</header>

<section class="listings-container">
    <div class="pg-grid">
        <% if(pgs && pgs.length > 0) { %>
            <% pgs.forEach(pg => { %>
                <div class="pg-card" onclick="window.location.href='/pg/<%= pg.id %>'">
                    <img src="<%= pg.image %>" alt="<%= pg.name %>">
                    <div class="pg-info">
                        <h3><%= pg.name %></h3>
                        <p><%= pg.location %></p>
                        <p class="price">â‚¹<%= pg.rent %></p>
                    </div>
                </div>
            <% }) %>
        <% } else { %>
            <p style="text-align: center; width: 100%;">No accommodations found.</p>
        <% } %>
    </div>
</section>

<script>
    const areaData = <%- JSON.stringify(areaData || []) %>;
    function updateColleges() {
        const areaVal = document.getElementById('locationSelect').value;
        const collDrop = document.getElementById('collegeSelect');
        collDrop.innerHTML = '<option value="">Select College</option>';
        
        const areaMatch = areaData.find(a => a.location === areaVal);
        if (areaMatch && areaMatch.colleges) {
            areaMatch.colleges.forEach(c => {
                const opt = document.createElement('option');
                opt.value = opt.text = c;
                collDrop.appendChild(opt);
            });
        }
    }
</script>

</body>
</html>